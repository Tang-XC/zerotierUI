import{r as n,b as $,a as L,u as V,j as e,T as W,I as f}from"./index-ljxfhu_I.js";import{D as H,a as J,b as K,c as C,d as I,e as Q}from"./Info-kLoJ2BsW.js";import{d as U}from"./index-y6qe4_Da.js";import{u as X,C as j,T as b,P as Y}from"./index.esm-sPTjBME5.js";import{T as Z,a as y}from"./index-WV0e7c-g.js";import{C as ee,h as te,d as re}from"./zerotier-q-DbUvf8.js";import{G as d}from"./Grid-ApQ2h4oY.js";import{a as m,B as se}from"./Button-YgSGqIkT.js";import{D as S}from"./Divider-quqlW_B7.js";import"./FormLabel-lVHghlsB.js";import"./Toolbar-Kv0VFcaH.js";import"./dividerClasses-IdYPJnRc.js";const fe=()=>{const[T,a]=n.useState(!1),[k,g]=n.useState(0),[_,o]=n.useState(!1),[v,D]=n.useState(null),[E,u]=n.useState(""),w=n.useRef(null),x=n.useRef(),{state:i}=$(),q=n.useMemo(()=>{let t=[{title:"网络名称",dataIndex:"name",key:"name"},{title:"网络ID",dataIndex:"id",key:"id"},{title:"成员数量",dataIndex:"members",key:"members",render:(r,s)=>r.length+"/"+s.max_memberships},{title:"拥有者",dataIndex:"owner",key:"owner"},{title:"创建时间",dataIndex:"created_at",key:"created_at",render:r=>new Date(r).toLocaleString()},{title:"备注",dataIndex:"desc",key:"desc"},{title:"",dataIndex:"action",key:"action",render:(r,s)=>e.jsxs(se,{sx:{display:"flex",justifyContent:"space-around",alignItems:"center",width:"100px",height:"100%",color:"primary.main"},children:[e.jsx(y,{title:"详情",children:e.jsx(f,{type:"button",disabled:!i.permissions.includes("network-detail"),onClick:()=>{u(s.id),N("/network/"+s.id)},children:e.jsx(I,{sx:{cursor:"pointer",color:"primary.main"}})})}),e.jsx(S,{orientation:"vertical",flexItem:!0}),e.jsx(y,{title:"编辑",children:e.jsx(f,{type:"button",disabled:!i.permissions.includes("network-edit"),onClick:()=>{G(s),u(s.id)},children:e.jsx(Q,{sx:{cursor:"pointer",color:"primary.main"}})})}),e.jsx(S,{orientation:"vertical",flexItem:!0}),e.jsx(y,{title:"删除",children:e.jsx(f,{type:"button",disabled:!i.permissions.includes("network-del"),onClick:c=>{u(s.id),D(c.currentTarget),o(!0)},children:e.jsx(U,{sx:{cursor:"pointer",color:"error.main"}})})})]})}];return["network-add","network-edit","network-del","network-detail"].every(r=>i.permissions.includes(r))||(t=t.filter(r=>r.dataIndex!="action")),t},[i]),A={name:"",desc:"",max_memberships:10},{handleSubmit:M,control:p,formState:{errors:l},reset:z}=X({defaultValues:A}),{dispatch:B}=L(),N=V(),h={fullWidth:!0,margin:"normal"},P=async t=>{var s;const r={...t,max_memberships:parseInt(t.max_memberships)};if(k===0){const c=await ee(r);c.code===200&&(a(!1),(s=x.current)==null||s.reload(),B({type:"SET_MESSAGE",payload:{type:"success",content:c.data,delay:5e3}}))}},R=async t=>{console.log(t);const r=await te({...t});return r.code===200?{data:r.data.networks}:{data:[]}},F=()=>{g(0),a(!0)},G=t=>{g(1),a(!0),z({...t})},O=async t=>{var s;await re(t)&&((s=x.current)==null||s.reload())};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{actionRef:x,columns:q,params:{page:1,size:10},request:R,onCreate:F,searchMode:"simple"}),e.jsxs(H,{open:T,onClose:()=>a(!1),scroll:"paper",children:[e.jsx(J,{children:k===0?"添加":"编辑"}),e.jsx(K,{sx:{width:"500px"},children:e.jsx("form",{ref:w,onSubmit:M(P),children:e.jsxs(d,{container:!0,columnSpacing:1,children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(j,{name:"name",control:p,rules:{required:!0},render:({field:t})=>e.jsx(b,{id:t.name,label:"网络名称",required:!0,error:!!l.name,helperText:l.name?"网络名称不能为空":null,...h,...t})})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(j,{name:"max_memberships",control:p,rules:{required:!0},render:({field:t})=>e.jsx(b,{id:t.name,label:"成员上限",type:"number",required:!0,error:!!l.max_memberships,helperText:l.max_memberships?"成员上限不能为空":null,...h,...t})})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(j,{name:"desc",control:p,render:({field:t})=>e.jsx(b,{id:t.name,label:"备注",...h,...t})})})]})})}),e.jsxs(C,{children:[e.jsx(m,{onClick:()=>{a(!1)},children:"取消"}),e.jsx(m,{variant:"contained",onClick:()=>{var t;(t=w.current)==null||t.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))},children:"确定"})]})]}),e.jsxs(Y,{open:_,anchorEl:v,onClose:()=>o(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:[e.jsxs(W,{sx:{p:2},display:"flex",alignItems:"center",children:[e.jsx(I,{sx:{pr:1},color:"warning"}),"确定要删除吗?"]}),e.jsxs(C,{children:[e.jsx(m,{size:"small",onClick:()=>{o(!1)},children:"取消"}),e.jsx(m,{size:"small",variant:"contained",color:"error",onClick:()=>{O(E),o(!1)},children:"确定"})]})]})]})};export{fe as default};
