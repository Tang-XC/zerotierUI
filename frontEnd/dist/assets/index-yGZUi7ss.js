import{r as n,a as W,b as H,j as e,T as J,I as E,g as K,c as L,d as N,e as Q,f as X,h as Y}from"./index-zagjAXpn.js";import{d as Z}from"./LockReset-_Bdu7hO3.js";import{u as ee,C as p,T as x,P as se}from"./index.esm-VSp74q1d.js";import{T as te,a as w}from"./index-cZy0dcPX.js";import{d as re}from"./index-5I_I5o-u.js";import{w as ne}from"./withAuth-4v6qJCif.js";import{D as ae,a as oe,b as ie,c as A,d as le,e as ce}from"./Info-qMsPI262.js";import{G as c}from"./Grid-caY0DriI.js";import{M as de}from"./Toolbar-dqB7quMk.js";import{a as b,B as ue}from"./Button-oP4buTuz.js";import{D as M}from"./Divider-qWClhoFa.js";import"./FormLabel-A2euTGeW.js";import"./dividerClasses-87-CPEWq.js";const me=()=>{const[R,o]=n.useState(!1),[l,T]=n.useState(0),C=n.useRef(null),h=n.useRef(null),[g,S]=n.useState(0),[_,f]=n.useState(!1),[D,q]=n.useState(null),[v,G]=n.useState([]),I={account:"",password:"",name:"",email:"",phone:"",roles:[]},{control:d,handleSubmit:F,reset:k,formState:{errors:u}}=ee({defaultValues:I}),{dispatch:j}=W(),{state:a}=H();console.log(a);const O=n.useMemo(()=>{let s=[{title:"用户名",dataIndex:"name",key:"name"},{title:"账号",dataIndex:"account",key:"account"},{title:"邮箱",dataIndex:"email",key:"email"},{title:"手机号",dataIndex:"phone",key:"phone"},{title:"角色",dataIndex:"roles",key:"roles",render:t=>t.map(r=>r.name).join("、")},{title:"",dataIndex:"action",key:"action",render:(t,r)=>e.jsxs(ue,{sx:{display:"flex",justifyContent:"space-around",alignItems:"center",width:"100px",height:"100%",color:"primary.main"},children:[e.jsx(w,{title:"编辑",children:e.jsx(E,{type:"button",disabled:!a.permissions.includes("user-edit"),onClick:()=>{$(r),S(r.id)},children:e.jsx(ce,{sx:{cursor:"pointer",color:a.permissions.includes("user-edit")?"primary.main":"action.disabled"}})})}),e.jsx(M,{orientation:"vertical",flexItem:!0}),e.jsx(w,{title:"重置密码",children:e.jsx(E,{type:"button",disabled:!a.permissions.includes("user-pdReset"),onClick:()=>{S(r.id),T(2),o(!0)},children:e.jsx(Z,{sx:{cursor:"pointer",color:a.permissions.includes("user-pdReset")?"primary.main":"action.disabled"}})})}),e.jsx(M,{orientation:"vertical",flexItem:!0}),e.jsx(w,{title:"删除",children:e.jsx(E,{type:"button",disabled:!a.permissions.includes("user-del"),onClick:y=>{S(r.id),q(y.currentTarget),f(!0)},children:e.jsx(re,{sx:{cursor:"pointer",color:a.permissions.includes("user-del")?"error.main":"action.disabled"}})})})]})}];return["user-add","user-edit","user-del","user-pdReset"].every(t=>a.permissions.includes(t))||(s=s.filter(t=>t.dataIndex!="action")),s},[a]),m={margin:"normal",fullWidth:!0},P=async()=>{const s=await K();s.code===200&&G(s.data)},U=async s=>{const t=await L(s);return t.code===200?{data:t.data}:{data:[]}},B=()=>{o(!0),k(I)},z=async s=>{var t,r,y;if(l===0){const i=await N({...s,roles:[s.roles]});i.code===200&&(j({type:"SET_MESSAGE",payload:{type:"success",content:i.data,delay:5e3}}),(t=h.current)==null||t.reload(),o(!1))}else if(l===1){const i=await Q(g,{...s,roles:[s.roles]});i.code===200&&(j({type:"SET_MESSAGE",payload:{type:"success",content:i.data,delay:5e3}}),(r=h.current)==null||r.reload(),o(!1))}else if(l===2){const i=await X(g,{new_password:s.password});i.code===200&&(j({type:"SET_MESSAGE",payload:{type:"success",content:i.data,delay:5e3}}),(y=h.current)==null||y.reload(),o(!1))}},$=s=>{T(1),o(!0),k({...s,roles:s.roles.map(t=>t.id)})},V=async s=>{var r;const t=await Y(s);t.code===200?(j({type:"SET_MESSAGE",payload:{type:"success",content:t.data,delay:5e3}}),(r=h.current)==null||r.reload()):j({type:"SET_MESSAGE",payload:{type:"error",content:t.msg,delay:5e3}})};return n.useEffect(()=>{P()},[]),e.jsxs(e.Fragment,{children:[e.jsx(te,{actionRef:h,columns:O,request:U,onCreate:B,searchMode:"simple"}),e.jsxs(ae,{open:R,onClose:()=>o(!1),scroll:"paper",children:[e.jsx(oe,{children:l===0?"添加":"编辑"}),e.jsx(ie,{sx:{width:"500px"},children:e.jsx("form",{ref:C,onSubmit:F(z),children:e.jsxs(c,{container:!0,columnSpacing:1,children:[[0,1].includes(l)&&e.jsx(e.Fragment,{children:e.jsx(c,{item:!0,xs:12,children:e.jsx(p,{name:"account",control:d,rules:{required:!0},render:({field:s})=>e.jsx(x,{id:s.name,label:"账号",required:!0,error:!!u.account,helperText:u.account?"账号不能为空":null,...m,...s})})})}),[2].includes(l)&&e.jsx(c,{item:!0,xs:12,children:e.jsx(p,{name:"password",control:d,rules:{required:!0},render:({field:s})=>e.jsx(x,{id:s.name,label:"密码",required:!0,error:!!u.password,helperText:u.password?"密码不能为空":null,...m,...s})})}),[0,1].includes(l)&&e.jsxs(e.Fragment,{children:[e.jsx(c,{item:!0,xs:6,children:e.jsx(p,{name:"roles",rules:{required:!0},control:d,render:({field:s})=>e.jsx(x,{id:s.name,label:"角色",required:!0,select:!0,error:!!u.roles,helperText:u.roles?"角色不能为空":null,...m,...s,children:v.map(t=>e.jsx(de,{value:t.id,children:t.name}))})})}),e.jsx(c,{item:!0,xs:6,children:e.jsx(p,{name:"name",control:d,render:({field:s})=>e.jsx(x,{id:s.name,label:"用户名",...m,...s})})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(p,{name:"email",control:d,render:({field:s})=>e.jsx(x,{id:s.name,label:"邮箱",...m,...s})})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(p,{name:"phone",control:d,render:({field:s})=>e.jsx(x,{id:s.name,label:"手机号",...m,...s})})})]})]})})}),e.jsxs(A,{children:[e.jsx(b,{onClick:()=>{o(!1)},children:"取消"}),e.jsx(b,{variant:"contained",onClick:()=>{var s;(s=C.current)==null||s.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))},children:"确定"})]})]}),e.jsxs(se,{open:_,anchorEl:D,onClose:()=>f(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:[e.jsxs(J,{sx:{p:2},display:"flex",alignItems:"center",children:[e.jsx(le,{sx:{pr:1},color:"warning"}),"确定要删除吗?"]}),e.jsxs(A,{children:[e.jsx(b,{size:"small",onClick:()=>{f(!1)},children:"取消"}),e.jsx(b,{size:"small",variant:"contained",color:"error",onClick:()=>{V(g),f(!1)},children:"确定"})]})]})]})},Ie=()=>ne(me);export{Ie as default};
